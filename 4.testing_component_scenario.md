# 컴포넌트 테스트 시나리오

## 1. 컴포넌트 바인딩
### 컴포넌트의 특정 필드가 부모 컴포넌트에 의해 동적으로 바인딩 되는지 테스트
- `banner.component.ts`
- `banner.component.spec.ts`, `banner.component.detect-changes.spec.ts`
- banner 컴포넌트의 문자열이 바인딩 되었는지, 동적으로 변경되는지 테스트

<hr/>

### 테스트 시나리오
- banner 컴포넌트에서 `<h1>` 엘리먼트를 찾아 값을 검사한다.
1. `<h1>` 엘리먼트를 찾기

    ```typescript
    let component: BannerComponent;
    let fixture: ComponentFixture<BannerComponent>;
    let h1: HTMLElement;

    beforeEach(() => {
        TestBed.configureTestingModule({declarations: [ BannerComponent ]});
        fixture = TestBed.createComponent(BannerComponent);
        component = fixture.componentInstance; // BannerComponent 인스턴스
        h1 = fixture.nativeElement.querySelector('h1');
    });
    ```
2. `title` 프로퍼티에 할당된 문자열이 제대로 표시되는지 확인 > **에러!**
    ```typescript
    it('should display original title', () => {
        expect(h1.textContent).toContain(component.title);
    });
    ```
    >에러 : _expected '' to contain 'Test Tour of Heroes'_   
    > 에러가 발생하는 이유는 `TestBed`로 `createComponent()`를 했지만, 이는 데이터가 바인딩 된 상태가 아닌 초기 생성만 된 상태.

3. `<h1>`엘리먼트의 빈 문자열 값 확인
    ```typescript
    it('no title in the DOM after createComponent()', () => {
        expect(h1.textContent).toEqual('');
    });
    ```

4. `ComponentFixture.detectChanges()` : 컴포넌트의 변화 감지 로직을 실행하여 바인딩 결과 확인   
    + 이 메소드를 사용함으로써 데이터가 바인딩 된 후의 상태를 검사할 수 있다.
    + 데이터 바인딩의 경우는 Angular가 변화를 감지하였을 때 발생하기 때문에 `detectChanges()` 메소드를 수동으로 실행해야 한다.
    ```typescript
    // 예1
    it('should display original title after detectChanges()', () => {
        fixture.detectChanges();
        expect(h1.textContent).toContain(component.title);
    });

    // 예2
    it('should display a different test title', () => {
        component.title = 'Test Title';
        fixture.detectChanges();
        expect(h1.textContent).toContain('Test Title');
    });
    ```
    
    > 변화감지 로직을 자동으로 실행하는 방법
    > ------------------------------------
    > - `detectChanges()` 를 계속해서 호출하는 것이 아닌 자동으로 실행되는 것을 선호할 때
    > - `TestBed`를 설정할 때 `ComponentFixtureAutoDetect` 프로바이더를 지정
    ```typescript
    import { ComponentFixtureAutoDetect } from '@angular/core/testing';

    // ...
    // 테스트 모듈 설정 안
    TestBed.configureTestingModule({
        declarations: [ BannerComponent ],
        providers: [
            { provide: ComponentFixtureAutoDetect, useValue: true }
        ]
    });
    // ...
    ```

    >`ComponentFixtureAutoDetect` 설정의 한계
    > ---------------------------------------
    > Angular 테스트 환경에서는 컴포넌트의 `title` 값이 변경된 것을 직접 감지할 수 없다.   
    > `ComponentFixtureAutoDetect` 는 프로미스(`Promise`)가 완료되거나, 타이머 이벤트, DOM 이벤트와 같은 _비동기 작업_ 에만 반응한다.   
    > 따라서 컴포넌트의 프로퍼티를 직접 수정하게 되면 수정사항은 화면에 반영되지 않아, `ComponentFixture.detectChanges()` 를 직접 실행해주어야 한다.
    


<hr/>
